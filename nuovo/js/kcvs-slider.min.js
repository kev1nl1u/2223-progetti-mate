function KCVSSlider(config){var theSlider=this;for(var key in this.containerID="",this.inputID="",this.inputSize="6",this.title="",this.min=0,this.max=1,this.constraintMin=null,this.constraintMax=null,this.step=0,this.decimal=3,this.default=-1,this.showTitle=!0,this.showFill=!0,this.showScale=!0,this.fillFromDefault=!1,this.showModified=!1,config)config.hasOwnProperty(key)&&(this[key]=config[key]);if(this.containerID.length>0)if(this.container=$("#"+this.containerID),this.container.length>0){if(0===this.step&&(this.step=Math.pow(10,-this.decimal)),""==this.inputID&&(this.inputID=this.containerID+"Input"),config.hasOwnProperty("default")){if(this.default<this.min||this.default>this.max)return void console.error("Bork! "+this.inputID+" default "+this.default+"is out of range ("+this.min+", "+this.max+")");if(null!=this.constraintMin&&this.default<this.constraintMin||null!=this.constraintMax&&this.default>this.constraintMax)return void console.error("Bork! "+this.inputID+" default "+this.default+"is out of contraints ("+this.constraintMin+", "+this.constraintMax+")")}else this.default=(this.min+this.max)/2;this.currentValue=this.default,this.listening=!0,this._UIdisabled=!1,this.isSliding=!1;var fragment=$(document.createDocumentFragment());this.panel=$("<fieldset></fieldset>",{class:"kcvsPanel kcvsSliderPanel",id:this.inputID+"Panel"}).appendTo(fragment),this.labelRow=$("<div></div>",{class:"kcvsSliderLabelRow clearfix",id:this.inputID+"LabelRow"}).appendTo(this.panel),this.label=$("<label></label>",{class:"kcvsLabel kcvsWidgetTitle",for:this.inputID,html:this.title}).appendTo(this.labelRow),this.showTitle||this.label.addClass("show-for-sr"),this.controlRow=$("<div></div>",{class:"controlRow"}).appendTo(this.panel),this.input=$("<input>",{id:this.inputID,name:this.inputID,type:"number",step:this.step,value:parseFloat(this.default).toFixed(this.decimal)}).css("width",this.inputSize+"ch").appendTo(this.controlRow),this.slider=$("<div></div>",{id:this.inputID+"Track",class:"sliderTrack"}).appendTo(this.controlRow),this.showFill&&(this.sliderFill=$("<div></div>",{id:this.inputID+"Fill",class:"sliderFill"}).appendTo(this.slider)),this.handle=$("<span></span>",{id:this.inputID+"Handle",class:"sliderHandle kcvsWidgetPart buttonShine"}).appendTo(this.slider),this.showScale&&(this.slider.addClass("sliderWithScale"),this.scaleRow=$("<div></div>",{class:"kcvsSliderLabelRow",id:this.inputID+"ScaleRow"}).appendTo(this.slider),this.scaleMin=$("<span></span>",{class:"kcvsLabel kcvsSliderScale kcvsSliderScale-min",html:this.min}).appendTo(this.scaleRow),this.scaleMax=$("<span></span>",{class:"kcvsLabel kcvsSliderScale kcvsSliderScale-max",html:this.max}).appendTo(this.scaleRow)),this._trackPxToValue=function(px){return this.min+(this.max-this.min)*px/this.slider.width()},this._trackValueToPx=function(value){return this.slider.width()*(value-this.min)/(this.max-this.min)},this._trackPctToValue=function(pct){return this.min+(this.max-this.min)*pct/100},this._trackValueToPct=function(value){return 100*(value-this.min)/(this.max-this.min)},this._updateFill=function(){var w,l,l0;this.showFill&&(this.fillFromDefault?(w=(this.currentValue-this.default)/(this.max-this.min)*100,l0=(this.default-this.min)/(this.max-this.min)*100,l=Math.min(l0,l0+w)):(w=(this.currentValue-this.min)/(this.max-this.min)*100,l=0),this.sliderFill.css({left:l+"%",width:Math.abs(w)+"%"}))},this._updateFill(),this._updateHandle=function(){this.handle.css("left",this._trackValueToPct(this.currentValue)+"%")},this._updateHandle(),this.input.on("change",(function(event){theSlider._UISetValue(parseFloat(event.target.value))})),this.handle.dragStarted=function(){theSlider.handle.addClass("sliderHandleActive"),theSlider.isSliding=!0,theSlider.slider.trigger({type:"slideStart.kcvs.slider",slider:theSlider})},this.handle.dragged=function(event){d3.event&&(event=d3.event);var x=theSlider._trackPxToValue(event.x-theSlider.handle.width()/2);theSlider._UISetValue(x)},this.handle.dragEnded=function(){theSlider.handle.removeClass("sliderHandleActive"),theSlider.isSliding=!1,theSlider.slider.trigger({type:"slideStop.kcvs.slider",slider:theSlider})},d3.selectAll(this.handle).call(d3.drag().touchable(!0).on("start",theSlider.handle.dragStarted).on("drag",theSlider.handle.dragged).on("end",theSlider.handle.dragEnded)),this.slider.trackJump=function(event){var pointer;d3.mouse?pointer=d3.mouse(this):d3.pointer&&(pointer=d3.pointer(event,this));var x=theSlider._trackPxToValue(pointer[0]);theSlider._UISetValue(x)},d3.selectAll(this.slider).on("click",this.slider.trackJump),this._updateModified=function(isModified){this.showModified&&(null==isModified&&(isModified=Math.abs(this.currentValue-this.default)>=this.step),isModified?this.panel.addClass("modified"):this.panel.removeClass("modified"))},this._UISetValue=function(x){return this.isUIDisabled()?this.currentValue:this.setValue(x)},this.value=function(){return this.currentValue},this.setValue=function(x){var newVal=Math.min(Math.max(x,this.min),this.max);return null!=theSlider.constraintMin&&newVal<theSlider.constraintMin&&(newVal=theSlider.constraintMin,theSlider.slider.trigger({type:"constraint.kcvs.slider",slider:theSlider,constraint:"min"})),null!=theSlider.constraintMax&&newVal>theSlider.constraintMax&&(newVal=theSlider.constraintMax,theSlider.slider.trigger({type:"constraint.kcvs.slider",slider:theSlider,constraint:"max"})),this.currentValue=newVal,this.input.val(newVal.toFixed(theSlider.decimal)),this._updateHandle(),this._updateFill(),this._updateModified(),theSlider.listening&&theSlider.slider.trigger({type:"slide.kcvs.slider",slider:theSlider,value:theSlider.value(),isSliding:theSlider.isSliding}),this.currentValue},this.setValueSilently=function(x){var oldListening=this.listening;return this.setListening(!1),this.setValue(x),this.setListening(oldListening),this.currentValue},this.reset=function(){return this.setValue(this.default),this.currentValue},this.resetSilently=function(){return this.setValueSilently(this.default),this.currentValue},this.setTitle=function(newTitle){this.label.html(newTitle),this.title=newTitle},this.setStep=function(newStep){this.input.prop("step",newStep)},this.getStep=function(){return this.input.prop("step")},this.setConstraintMin=function(x){this.constraintMin=x},this.setConstraintMax=function(x){this.constraintMax=x},this.getConstraintMin=function(){return this.constraintMin},this.getConstraintMax=function(){return this.constraintMax},this.update=function(){this.input.trigger("change")},this.isUIDisabled=function(){return this._UIdisabled},this.disableUI=function(){this._UIdisabled=!0,this.panel.addClass("disabled"),this.input.attr("readonly",!0)},this.enableUI=function(){this._UIdisabled=!1,this.panel.removeClass("disabled"),this.input.attr("readonly",null)},this.resizeTimer=null,$(window).resize((function(){clearTimeout(theSlider.resizeTimer),theSlider.resizeTimer=setTimeout((function(){theSlider._updateFill(),theSlider._updateHandle()}),100)})),this.addListener=function(fcn,data){theSlider.slider.on("slide.kcvs.slider",data,(function(event){fcn(event)}))},this.setListening=function(lis){"boolean"==typeof lis&&(this.listening=lis)},this.container.append(fragment)}else console.error("Bork! No element found with ID="+this.containerID);else console.error("Bork! Must specify containerID to place slider!")}